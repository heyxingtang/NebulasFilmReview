<!DOCTYPE HTML>
<html>
<head>
<title>History</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="My Play Responsive web template, Bootstrap Web Templates, Flat Web Templates, Andriod Compatible web template, 
Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyErricsson, Motorola web design" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
<!-- bootstrap -->
<link href="css/bootstrap.min.css" rel='stylesheet' type='text/css' media="all" />
<!-- //bootstrap -->
<link href="css/dashboard.css" rel="stylesheet">
<!-- Custom Theme files -->
<link href="css/style.css" rel='stylesheet' type='text/css' media="all" />
<script src="js/jquery-1.11.1.min.js"></script>
<!--start-smoth-scrolling-->
<!-- fonts -->

<!-- //fonts -->
</head>
  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
         	<a class="navbar-brand" href="index.html"><h1>星云影评</h1></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
			<div class="top-search">
				<form class="navbar-form navbar-right" action="single.html" method="get">
					<input type="text" class="form-control" placeholder="请输入电影名称" name="q">
					<input type="submit" value="">
				</form>
			</div>
        </div>
		<div class="clearfix"> </div>
      </div>
    </nav>
        <div class="col-sm-3 col-md-2 sidebar">
			<div class="top-navigation">
				<div class="t-menu">MENU</div>
				<div class="t-img">
					<img src="images/lines.png" alt="" />
				</div>
				<div class="clearfix"> </div>
			</div>
				<div class="drop-navigation drop-navigation">
				  <ul class="nav nav-sidebar">
					<li class="active"><a href="index.html" class="home-icon"><span class="glyphicon glyphicon-home" aria-hidden="true"></span>首页</a></li>
					<li class="active"><a href="#" class="sub-icon"><span class="glyphicon glyphicon-home glyphicon-hourglass" aria-hidden="true"></span>我的评论</a></li>
				  </ul>
				  <!-- script-for-menu -->
						<script>
							$( ".top-navigation" ).click(function() {
							$( ".drop-navigation" ).slideToggle( 300, function() {
							// Animation complete.
							});
							});
						</script>
				</div>
        </div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
			<div class="show-top-grids">
				<div class="main-grids news-main-grids">
					<div class="recommended-info">
						<h3>评论历史记录</h3>
						<p class="history-text">
							</span>
						</p>
						<div id="my_history">
						
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="clearfix"> </div>
	<div class="drop-menu">
		<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu4">
		  <li role="presentation"><a role="menuitem" tabindex="-1" href="#">Regular link</a></li>
		  <li role="presentation" class="disabled"><a role="menuitem" tabindex="-1" href="#">Disabled link</a></li>
		  <li role="presentation"><a role="menuitem" tabindex="-1" href="#">Another link</a></li>
		</ul>
	</div>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/bootstrap.min.js"></script>
    <script src="js/nebPay.js"></script>
	<script src="js/nebulas.js"></script>
    <!-- Just to make our placeholder images work. Don't actually copy the next line! -->
    <script>
		const contractAddress = "n1gCBS2DzxBnDmC1T4VcEDGsbv3NgSWCVGv";
	//	const nebulas = require("nebulas");
    	//const neb = new nebulas.Neb(new nebulas.HttpRequest("https://testnet.nebulas.io"));
    	const NebPay = require("nebpay"); //https://github.com/nebulasio/nebPay
    	const nebPay = new NebPay();
    	let movie_id = 0;
    	const to = contractAddress;
		const value = "0";
		
		function load_history(){
			nebPay.simulateCall(to, value, "showUserReview", "[]", {
                    listener: refreshPage
                });
		}
		function refreshPage(resp) {
        	let history_obj = JSON.parse(resp.result);
        	//alert(JSON.stringify(obj));
        	let history_list = "";
			for(var i=0;i<=history_obj.num-1;i++){
				let history_timer = new Date(history_obj.data[i].ts * 1000).toLocaleString();
				history_list += "<div class=\"history-grids\"><div class=\"col-md-1 history-left\"><p>" + (i+1)
					+ "</p></div><div class=\"col-md-11 history-right\"><a href=\"single.html?id="+history_obj.data[i].id+"\"><h5>" + history_obj.data[i].id+"</h5></a><p>"
					+ history_obj.data[i].content + "</p><p>"+history_timer+"</p></div><div class=\"clearfix\"> </div></div>"
			}
        	document.getElementById("my_history").innerHTML = history_list;	 
    	}
		window.onload = load_history;
	</script>
  </body>
</html>
